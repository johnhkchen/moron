---
id: T-010-02
story: S-010
title: parallel-frame-computation
type: task
status: open
priority: high
phase: ready
depends_on: [T-010-01]
blocks: [T-010-04]
---

## Context

Frame state computation (`compute_frame_state()`) is pure Rust with no side effects â€” it reads from an immutable `&M` and produces a `FrameState`. This is trivially parallelizable with Rayon. JSON serialization of each `FrameState` is similarly independent.

Even if computation is a small fraction of total time, pre-computing all frame states in a parallel batch before Chrome capture begins improves the pipeline: Chrome capture can then read from a pre-built vec instead of computing on-the-fly.

## Acceptance Criteria

- Add `rayon` as a dependency to moron-core
- Implement a batch function: `compute_all_frame_states(&M) -> Vec<(u32, String)>` returning (frame_number, json_string) pairs
- Use Rayon's `par_iter` to compute frame states and serialize to JSON in parallel
- Integrate into `render()` so frame states are pre-computed before the capture loop
- Tests verify identical output (JSON strings match sequential computation)
- Benchmark shows measurable improvement on computation stage (even if small)
