---
id: T-004-01
story: S-004
title: frame-state-serialization
type: task
status: open
priority: high
phase: ready
depends_on: [T-003-04]
blocks: [T-004-02, T-004-03]
---

## Context

Define a `FrameState` struct that captures the complete visual state at a given point in the timeline. This is the data contract between Rust and React — Rust computes it, serializes to JSON, and React renders it.

At a given timestamp, the frame state includes:
- Which elements are visible and their visual properties (opacity, translate, scale, rotation from TechniqueOutput)
- Current theme (as CSS custom properties)
- Active text content (narration text, titles, sections, metrics, steps)
- Timeline metadata (current time, total duration, frame number)

The FrameState must be serializable to JSON via serde. It should be computable from a Timeline + timestamp.

### Key design question

How to track which elements are "active" at a given time. The current M facade mints Element handles and records Segments, but there's no explicit mapping from Element → Segment or Element → visual state at time T. This ticket needs to design that mapping.

Possible approach: extend M to record element metadata (text, type) alongside the timeline, then FrameState resolves which elements are visible based on timeline position.

Files: moron-core/src/frame.rs (new), moron-core/src/facade.rs (extend element tracking)

## Acceptance Criteria

- FrameState struct with serde Serialize/Deserialize
- Can compute a FrameState from a built scene at any timestamp
- JSON output contains element visual states, theme properties, text content
- Unit tests: serialize a FrameState, verify JSON structure
- `cargo check` passes
